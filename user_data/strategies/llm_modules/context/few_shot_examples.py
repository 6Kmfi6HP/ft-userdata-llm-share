"""
Few-Shot示例库：专业交易决策的CoT推理模板

根据Google提示词工程白皮书最佳实践，提供高质量示例来指导LLM进行系统化推理。
每个示例展示完整的4步CoT框架：市场识别 → 策略选择 → 信号验证 → 风险评估

Created: 2025-01-23
Purpose: 将LLM从"趋势交易员"转变为"专业交易员"
"""

# ===========================
# 开仓决策示例 (Entry Examples)
# ===========================

ENTRY_EXAMPLES = [
    # 示例1：趋势跟随-趋势延续（强趋势追涨）
    {
        "scenario": "趋势跟随-趋势延续",
        "market_context": """
【市场数据】BTC/USDT:USDT 30分钟
当前价格: 42,500 USDT
EMA20: 42,300 | EMA50: 41,800 | EMA100: 41,200 (多头排列持续6根K线)
MACD柱状图: 125→145→165→180→200 (连续5根K线扩张,当前200)
MACD快慢线: DIF(280) > DEA(180),金叉持续8根K线
RSI: 58 (从45持续上升,无超买)
ADX: 28且持续上升 (25→26→28,趋势强度充足)
成交量: 较前一根K线放大45% (1200万→1740万)
支撑位: 41,800 (EMA50) | 阻力位: 43,500 (前高)
ATR: 200 USDT

【账户状态】
可用资金: 1,000 USDT | 当前持仓: 0
""",
        "correct_reasoning": """
【强制推理链 - Chain of Thought】

第1步 - 市场状态识别:
分析当前市场处于哪种状态:
• EMA排列: 20(42300) > 50(41800) > 100(41200),清晰多头排列,持续6根K线
• ADX指标: 28且持续上升(25→26→28),显示趋势强度充足且增强中
• MACD动能: 柱状图连续5根K线扩张(125→200),DIF>DEA金叉持续8根
• 价格行为: 持续创新高,无明显回调,Higher High结构清晰
→ 结论: 【趋势市场-多头】(强趋势,非震荡或反转)

第2步 - 交易策略选择:
根据第1步"趋势市场-多头"结果,选择对应策略:
• 当前状态: 强趋势加速期,价格已突破前高42,200创新高42,500
• 价格位置: 在EMA20上方运行,未回调至支撑位
• 动能特征: MACD柱状图加速扩张,成交量放大45%,突破有效
• 风险评估: 等待回调可能错过行情(强趋势中回调幅度小且短暂)
→ 选择策略: 【趋势跟随-趋势延续】(追涨入场,非等待回调)
→ 理由: 强趋势中价格加速突破,动能充足,适合追涨捕捉延续段

第3步 - 入场条件验证:
检查所选策略的必要条件(需满足≥2项独立信号):
✓ 价格结构: 创新高42,500,较前高42,200上涨300点 = 1.5倍ATR(200×1.5=300) ✓
✓ 关键位突破: 突破42,200阻力,幅度300点 = 150% ATR,突破后站稳3根K线 ✓
✓ EMA排列: 多头排列20>50>100,方向明确且持续6根K线 ✓
✓ 动量确认: MACD柱状图连续5根K线同向扩张(125→200) ✓
✓ 成交量配合: 较前一根K线放大45%,显示真实买盘 ✓
→ 满足信号: 5个独立信号全部满足,置信度极高

第4步 - 风险收益评估:
• 入场价: 42,500 (当前价格)
• 止损位: 41,800 (EMA50关键支撑,破位则趋势可能转弱)
  - 止损距离: 42,500 - 41,800 = 700点 = 3.5倍ATR (合理,不过近不过远)
• 目标位: 44,000 (前期重要阻力位,技术上可达)
  - 盈利空间: 44,000 - 42,500 = 1,500点
• R:R比: 1,500 / 700 = 2.14:1 (符合≥2:1要求) ✓
• 仓位占比: 40% (高置信度,但预留60%用于其他机会/加仓)
• 杠杆选择: 8x (置信度高85/100,使用适中偏高杠杆,非极端)

【最终决策】完成上述4步推理,满足全部条件,调用signal_entry_long开多仓
""",
        "function_call": {
            "name": "signal_entry_long",
            "arguments": {
                "market_state": "趋势市场-多头",
                "strategy_selected": "趋势跟随-趋势延续",
                "entry_signals": [
                    "价格结构:创新高42500,涨幅300点=1.5倍ATR,Higher High明确",
                    "EMA排列:多头排列20>50>100持续6根K线,方向清晰",
                    "动量确认:MACD柱连续5根扩张125→200,金叉持续8根",
                    "成交量:放大45%至1740万,突破有效",
                    "关键位:突破42200阻力150% ATR且站稳3根K线"
                ],
                "risk_reward_analysis": {
                    "entry_price": 42500,
                    "stop_loss": 41800,
                    "target": 44000,
                    "rr_ratio": 2.14
                },
                "pair": "BTC/USDT:USDT",
                "leverage": 8,
                "stake_amount": 400,
                "confidence_score": 85,
                "key_support": 41800,
                "key_resistance": 44000,
                "rsi_value": 58,
                "trend_strength": "强势"
            }
        }
    },

    # 示例2：区间震荡-支撑反弹（震荡市高抛低吸）
    {
        "scenario": "区间震荡-支撑反弹",
        "market_context": """
【市场数据】ETH/USDT:USDT 30分钟
当前价格: 2,280 USDT
EMA20: 2,295 | EMA50: 2,290 | EMA100: 2,285 (三线纠缠,间距<0.5%)
MACD柱状图: -5→-3→-1→2→5 (来回震荡,无明确方向)
RSI: 35 (从28反弹,接近超卖区边缘)
ADX: 15且下降 (20→18→15,趋势强度不足)
成交量: 正常水平,无明显放量
支撑位: 2,250 (多次测试未破) | 阻力位: 2,350 (多次受阻)
ATR: 50 USDT
最近价格波动: 2,250-2,350区间震荡持续15根K线

【账户状态】
可用资金: 800 USDT | 当前持仓: 0
""",
        "correct_reasoning": """
【强制推理链 - Chain of Thought】

第1步 - 市场状态识别:
• EMA排列: 三线纠缠(20:2295, 50:2290, 100:2285),间距<0.5%,无明确方向
• ADX指标: 15且下降(20→18→15),趋势强度严重不足(<20为震荡)
• 价格行为: 在2,250-2,350区间震荡15根K线,未形成突破
• MACD: 柱状图来回震荡无方向,显示动能混乱
→ 结论: 【区间震荡】(非趋势市场,支撑阻力明确的横盘)

第2步 - 交易策略选择:
• 当前状态: 区间震荡市,价格接近下沿支撑2,250
• 价格位置: 2,280接近支撑2,250(距离30点=0.6倍ATR),远离上沿阻力2,350
• RSI位置: 35从28反弹,显示超卖后技术性修复
• 区间特征: 支撑2,250多次测试未破(强支撑),阻力2,350多次受阻(强阻力)
→ 选择策略: 【区间震荡-支撑反弹】(低位做多,高位止盈,严格止损)
→ 理由: 震荡市中在支撑位附近做多,目标上沿阻力,R:R比优

第3步 - 入场条件验证:
✓ 价格结构: 触及支撑区2,250-2,280,历史多次测试未破 ✓
✓ RSI超卖: 35从28反弹,显示卖压衰竭,买盘介入 ✓
✓ 风险位置: 接近区间下沿,下跌空间有限(止损仅需30点) ✓
✗ EMA排列: 纠缠无方向 (震荡市正常,不作为独立信号)
✗ 动量确认: MACD无明确方向 (震荡市正常)
→ 满足信号: 3个有效信号(价格位置+RSI+风险收益),震荡市策略有效

第4步 - 风险收益评估:
• 入场价: 2,280 (当前价格,接近支撑)
• 止损位: 2,240 (支撑2,250下方10点,破位则区间失效)
  - 止损距离: 40点 = 0.8倍ATR (震荡市止损应紧,避免假突破)
• 目标位: 2,340 (阻力2,350下方10点,提前止盈避免反转)
  - 盈利空间: 60点
• R:R比: 60 / 40 = 1.5:1 (略低于2:1,但震荡市可接受)
• 仓位占比: 25% (震荡市不确定性高,仓位适中)
• 杠杆选择: 5x (中等置信度60/100,使用中低杠杆)

【最终决策】震荡市支撑位策略,满足条件,调用signal_entry_long
【重要提醒】震荡市必须严格止损!破2,240立即退出,不可抗单
""",
        "function_call": {
            "name": "signal_entry_long",
            "arguments": {
                "market_state": "区间震荡",
                "strategy_selected": "区间震荡-支撑反弹",
                "entry_signals": [
                    "价格位置:2280接近支撑2250,历史多次测试未破",
                    "RSI超卖:35从28反弹,卖压衰竭",
                    "风险收益:接近区间下沿,下跌空间有限仅40点止损"
                ],
                "risk_reward_analysis": {
                    "entry_price": 2280,
                    "stop_loss": 2240,
                    "target": 2340,
                    "rr_ratio": 2.0
                },
                "pair": "ETH/USDT:USDT",
                "leverage": 5,
                "stake_amount": 200,
                "confidence_score": 60,
                "key_support": 2250,
                "key_resistance": 2350,
                "rsi_value": 35,
                "trend_strength": "震荡"
            }
        }
    },

    # 示例3：反转交易-新趋势起点（空头反转）
    {
        "scenario": "反转交易-新趋势起点",
        "market_context": """
【市场数据】BNB/USDT:USDT 30分钟
当前价格: 305 USDT
EMA20: 308 | EMA50: 312 | EMA100: 315 (价格跌破全部EMA,空头排列形成)
MACD柱状图: 15→8→2→-5→-12 (由正转负,死叉确认3根K线)
MACD快慢线: DIF(-8) < DEA(5),死叉后持续扩散
RSI: 42 (从65快速下跌,跌破中线50)
ADX: 22且上升 (15→18→22,趋势强度开始建立)
成交量: 较前一根K线放大60% (显示恐慌性卖盘)
支撑位: 300 (整数关口) | 阻力位: 315 (原支撑转阻力,EMA100)
ATR: 8 USDT
结构破坏: 跌破310关键支撑(原上升趋势线),Lower Low确认

【账户状态】
可用资金: 1,200 USDT | 当前持仓: 0
""",
        "correct_reasoning": """
【强制推理链 - Chain of Thought】

第1步 - 市场状态识别:
• EMA排列: 价格305 < EMA20(308) < EMA50(312) < EMA100(315),空头排列形成
• 结构破坏: 跌破310关键支撑,原上升趋势线失效,形成Lower Low
• MACD信号: 死叉后持续扩散(DIF -8, DEA 5),柱状图由正转负确认3根K线
• ADX趋势: 22且上升(15→18→22),新趋势强度开始建立
• RSI行为: 从65快速跌破50中线至42,动能明确转空
→ 结论: 【反转确认-空头】(多头趋势结束,空头趋势起点)

第2步 - 交易策略选择:
• 当前状态: 多头结构全面破坏,空头信号多维度确认
• 反转证据: ①价格跌破全部EMA ②MACD死叉确认 ③关键支撑破位 ④成交量放大
• 趋势阶段: 反转初期,新趋势刚建立,非趋势末期
• 风险评估: 反转交易需三维度确认(价格结构+指标+成交量),当前全部满足
→ 选择策略: 【反转交易-新趋势起点】(空头反转,做空入场)
→ 理由: 多重确认下的反转起点,风险收益比优于等待进一步下跌

第3步 - 入场条件验证:
✓ 价格结构: 跌破310支撑,形成Lower Low,空头排列305<308<312<315 ✓
✓ 关键位破坏: 跌破310支撑位,幅度5点=0.625倍ATR,站稳3根K线 ✓
✓ EMA排列: 空头排列形成,价格跌破全部EMA,方向明确 ✓
✓ 动量确认: MACD死叉持续3根K线,柱状图由正转负扩散 ✓
✓ 成交量: 放大60%,显示真实卖压而非虚假突破 ✓
✓ 多时间框架: (假设)1小时图也显示MACD死叉,RSI<50 ✓
→ 满足信号: 6个独立信号,反转三维度确认完成,置信度高

第4步 - 风险收益评估:
• 入场价: 305 (当前价格)
• 止损位: 316 (EMA100上方1点,反抽不破则反转确认)
  - 止损距离: 11点 = 1.375倍ATR (反转交易止损需略宽,防止反抽)
• 目标位: 290 (下一支撑位300下方10点,保守目标)
  - 盈利空间: 15点
• R:R比: 15 / 11 = 1.36:1 (略低,但反转初期可接受)
• 仓位占比: 30% (反转交易不确定性高于趋势跟随,仓位适中)
• 杠杆选择: 6x (置信度75/100,适中杠杆)

【最终决策】反转三维度确认完成,调用signal_entry_short开空仓
【重要提醒】反转交易必须严格止损!反抽破316立即止损,不可幻想多头复活
""",
        "function_call": {
            "name": "signal_entry_short",
            "arguments": {
                "market_state": "反转确认-空头",
                "strategy_selected": "反转交易-新趋势起点",
                "entry_signals": [
                    "价格结构:跌破310支撑形成Lower Low,空头排列305<308<312<315",
                    "EMA排列:价格跌破全部EMA,空头排列明确",
                    "动量确认:MACD死叉持续3根,柱状图由正转负扩散",
                    "成交量:放大60%显示真实卖压",
                    "关键位:跌破310支撑0.625倍ATR站稳3根",
                    "多框架:1小时图MACD死叉+RSI<50对齐"
                ],
                "risk_reward_analysis": {
                    "entry_price": 305,
                    "stop_loss": 316,
                    "target": 290,
                    "rr_ratio": 2.0
                },
                "pair": "BNB/USDT:USDT",
                "leverage": 6,
                "stake_amount": 360,
                "confidence_score": 75,
                "key_support": 300,
                "key_resistance": 315,
                "rsi_value": 42,
                "trend_strength": "反转初期"
            }
        }
    },

    # 示例4：信号不足-等待观望（signal_wait）
    {
        "scenario": "信号不足-等待观望",
        "market_context": """
【市场数据】SOL/USDT:USDT 30分钟
当前价格: 98.5 USDT
EMA20: 98.2 | EMA50: 98.8 | EMA100: 98.0 (三线严重纠缠,方向不明)
MACD柱状图: -2→1→-1→0.5 (频繁正负交替,无明确方向)
RSI: 52 (中性区域,无超买超卖信号)
ADX: 12且横盘 (趋势强度极弱,典型震荡)
成交量: 低迷,较均值下降30%
支撑位: 97.0 | 阻力位: 100.0 (区间不明确,多次假突破)
ATR: 2.5 USDT

【账户状态】
可用资金: 1,000 USDT | 当前持仓: 0
""",
        "correct_reasoning": """
【强制推理链 - Chain of Thought】

第1步 - 市场状态识别:
• EMA排列: 三线严重纠缠(20:98.2, 50:98.8, 100:98.0),间距<1%,方向不明
• ADX指标: 12且横盘,趋势强度极弱(<15为极弱震荡)
• 价格行为: 在97-100区间窄幅波动,无明确方向,多次假突破
• MACD: 柱状图频繁正负交替(-2→1→-1→0.5),动能混乱
→ 结论: 【市场状态不明】(既非明确趋势,也非明确震荡区间,属于混沌期)

第2步 - 交易策略选择:
• 当前状态: 市场方向不明,信号混乱,无明确交易机会
• 可选策略分析:
  - 趋势跟随: ✗ ADX仅12,无趋势可跟
  - 区间震荡: ✗ 支撑阻力不明确,多次假突破,难以把握
  - 反转交易: ✗ 无明确趋势可反转
→ 选择策略: 【无合适策略,等待观望】
→ 理由: 在信号不明确时交易=赌博,专业交易员应保护资本,等待高概率机会

第3步 - 入场条件验证:
✗ 价格结构: 无明确Higher High或Lower Low,横盘为主
✗ 关键位: 支撑阻力不明确,97和100多次被假突破
✗ EMA排列: 严重纠缠,无方向
✗ 动量确认: MACD频繁正负交替,无持续3根K线同向
✗ 成交量: 低迷,下降30%,显示观望情绪浓厚
→ 满足信号: 0个独立信号,完全不符合入场条件

第4步 - 风险收益评估:
• 入场价: 无(不入场)
• 止损位: 无法设定合理止损(支撑阻力不明确)
• 目标位: 无法设定合理目标(方向不明)
• R:R比: 无法计算(无交易)
• 决策: 保护资本,等待市场给出明确信号后再行动

【最终决策】信号不足,市场不明朗,调用signal_wait等待观望
【专业原则】不确定时不交易 > 盲目交易亏损,保护资本是第一优先级
""",
        "function_call": {
            "name": "signal_wait",
            "arguments": {
                "pair": "SOL/USDT:USDT",
                "reason": "【信号不足-等待观望】市场状态不明:①EMA三线严重纠缠无方向 ②ADX仅12趋势极弱 ③MACD频繁正负交替无明确动能 ④成交量低迷下降30% ⑤支撑阻力不明确多次假突破。无明确趋势/震荡/反转信号,0个独立信号满足入场条件。专业交易员应等待高概率机会,而非在混沌期赌博。",
                "market_analysis": "市场处于方向选择期,ADX=12显示多空力量均衡但都不强。等待以下信号之一:①ADX突破20+价格突破100阻力(趋势确立) ②价格明确回落至95-100区间震荡(区间交易) ③放量突破100或跌破97(方向选择)",
                "confidence_score": 0
            }
        }
    },

    # 示例5：盈利保护-减仓锁利（adjust_position）
    {
        "scenario": "盈利保护-强制减仓",
        "market_context": """
【持仓信息】
方向: 多头 | 入场价: 42,000 | 当前价: 45,500
持仓时长: 8小时 | 杠杆: 8x | 仓位: 400 USDT
当前盈亏: +8.3% (未实现盈利33.2 USDT)
最大浮盈MFE: +12.5% (曾达到50 USDT)
开仓理由: EMA多头排列+MACD金叉+突破42,200阻力

【当前市场】BTC/USDT:USDT 30分钟
价格: 45,500 | EMA20: 45,200 | EMA50: 44,500 | EMA100: 43,800
MACD柱状图: 180→165→150→120 (连续4根K线收窄,但仍为正)
MACD快慢线: DIF(150) > DEA(100),金叉保持但差距收窄
RSI: 68 (从75回落,但未跌破50中线)
ADX: 32且开始回落 (35→33→32,高位但趋势减弱)
成交量: 正常,无异常放量
""",
        "correct_reasoning": """
【强制推理链 - Chain of Thought】

第0步 - 噪声过滤(最优先):
• MACD变化: 柱状图从180降至120,变化60点,持续4根K线
• ATR当前值: 150 (假设)
• 变化比例: 60/150 = 40% > 30%阈值
• 持续性检查: 连续4根K线同向收窄,非单根波动
→ 通过噪声检查: 是(变化显著且持续,非市场噪声)

第1步 - 盈利保护检查(第一优先级):
• 当前盈亏: +8.3%
• 最大浮盈MFE: +12.5%
• 回撤幅度: 12.5% - 8.3% = 4.2%
• 回撤比例: 4.2% / 12.5% = 33.6%
强制执行规则对照:
□ 浮盈转亏损(MFE>3%且当前<0%): 否 (当前+8.3%)
□ 回撤>50%: 否 (33.6%<50%)
□ 回撤30-50%: 是 (33.6%在此区间) ✓
→ 触发规则: 【回撤30-50%,执行adjust_position -30%】
→ 说明: 虽然仍有+8.3%盈利,但从最高点+12.5%回撤33.6%,触发盈利保护机制

【决策逻辑】
盈利保护优先于锚点检查!虽然开仓锚点(EMA多头排列+MACD金叉)仍然完好,
但根据新规则"盈利保护>锚点检查",应立即执行减仓30%锁定部分利润,
剩余70%仓位继续持有观察。

第2步 - 补充市场分析(支撑决策理由):
虽然盈利保护规则已触发,但仍需分析市场状态以完善决策理由:
• 锚点状态: EMA多头排列保持(45500>45200>44500),MACD金叉未破,锚点完好
• 动能变化: MACD柱状图收窄显示多头动能减弱,但未转空
• RSI行为: 从75高位回落至68,显示短期获利盘了结,但未破50中线
• ADX趋势: 32仍处高位,但开始回落,趋势延续性存疑
综合判断: 趋势尚未破坏,但动能减弱+获利盘压力,减仓30%平衡风险收益

【最终决策】触发盈利保护规则(回撤30-50%),调用adjust_position -30
【执行说明】减仓30%(120 USDT),锁定利润约10 USDT,剩余280 USDT继续持有
""",
        "function_call": {
            "name": "adjust_position",
            "arguments": {
                "pair": "BTC/USDT:USDT",
                "adjustment_pct": -30,
                "reason": "【盈利保护-强制执行】当前盈亏+8.3%,最大浮盈+12.5%,回撤比例33.6%触发30-50%阈值。虽然锚点完好(EMA多头排列保持45500>45200>44500,MACD金叉DIF150>DEA100未破),但根据盈利保护优先原则,MACD柱状图连续4根收窄180→120显示多头动能减弱,RSI从75回落至68显示获利盘了结压力,ADX从35降至32趋势延续性存疑。执行减仓30%锁定部分利润,剩余70%仓位继续持有以捕捉潜在延续,若后续ADX重新上升或MACD柱状图再次扩张可考虑重新加仓。",
                "confidence_score": 85,
                "key_support": 44500,
                "key_resistance": 46000
            }
        }
    },

    # 示例6：锚点破坏-全部平仓（signal_exit）
    {
        "scenario": "锚点破坏-全部平仓",
        "market_context": """
【持仓信息】
方向: 多头 | 入场价: 2,280 | 当前价: 2,295
持仓时长: 12小时 | 杠杆: 5x | 仓位: 200 USDT
当前盈亏: +0.66% (微利15.3 USDT)
最大浮盈MFE: +2.8% (曾达到64 USDT)
开仓理由: 区间震荡-支撑2,250反弹,目标2,340

【当前市场】ETH/USDT:USDT 30分钟
价格: 2,295 | EMA20: 2,288 | EMA50: 2,285 | EMA100: 2,282
MACD柱状图: 8→5→2→-1→-4 (由正转负,死叉持续3根K线)
MACD快慢线: DIF(-2) < DEA(3),死叉确认
RSI: 45 (从35反弹后再次回落,未能突破50)
价格行为: 触及2,310阻力后回落,未能到达目标2,340
关键信号: 跌破2,285支撑位,Lower Low形成
""",
        "correct_reasoning": """
【强制推理链 - Chain of Thought】

第0步 - 噪声过滤:
• 价格跌破2,285支撑,MACD死叉持续3根K线
• 变化显著且持续,非单根K线噪声
→ 通过噪声检查: 是

第1步 - 盈利保护检查:
• 当前盈亏: +0.66%
• 最大浮盈MFE: +2.8%
• 回撤比例: (2.8-0.66)/2.8 = 76.4%
□ 浮盈转亏损: 否 (仍有微利+0.66%)
□ 回撤>50%: 是 (76.4%>50%) ✓
→ 触发规则: 【回撤>50%,应执行adjust_position -50】
但需继续检查锚点状态,如锚点已破坏应直接全平而非减仓

第2步 - 分批止盈检查:
• 当前盈亏: +0.66% (远低于5%止盈线)
→ 不触发分批止盈规则

第3步 - 锚点破坏检查(决定性步骤):
量化评估开仓理由是否失效:
✓ EMA结构: 虽然仍维持微弱多头排列,但价格已跌破EMA20,结构松动 (满足0.5项)
✓ 关键位: 跌破2,285支撑(开仓时锚点为2,250支撑反弹),形成Lower Low (满足)
✓ 动能转向: MACD由正转负死叉持续3根K线,柱状图-4 (满足)
补充分析:
• 开仓策略: 区间震荡-支撑反弹,目标2,340阻力
• 当前情况: 价格触及2,310后回落(未达目标),跌破入场价2,280
• RSI行为: 从35反弹至60后再次回落至45,未能突破50中线,反弹失败
• 区间状态: 跌破2,285后区间下沿2,250面临考验,震荡策略失效
→ 锚点状态: 满足2.5项 → 【锚点破坏】
→ 决策: 立即全部平仓signal_exit,不再等待

第4步 - 综合决策:
• 盈利保护: 回撤76.4%要求减仓50%
• 锚点检查: 满足2.5/3项,锚点破坏
• 最终判断: 锚点已破坏+盈利大幅回撤,应全部平仓而非减仓
• 交易评分: 40/100 (未达目标,策略失效,但守住微利未亏损)

【最终决策】锚点破坏+盈利保护双重触发,调用signal_exit全部平仓
【交易总结】区间震荡策略失效,价格未能到达目标2,340即回落,跌破支撑2,285
显示区间下沿2,250可能面临破位,及时止损保护资本,避免微利转亏损。
""",
        "function_call": {
            "name": "signal_exit",
            "arguments": {
                "pair": "ETH/USDT:USDT",
                "reason": "【锚点破坏-全部平仓】开仓策略'区间震荡-支撑反弹'失效:①关键位破坏:跌破2285支撑形成Lower Low,区间下沿2250面临考验 ②动能转向:MACD由正转负死叉持续3根,柱状图-4 ③RSI反弹失败:从35反弹至60后再次回落45,未能突破50中线显示买盘不足 ④价格行为:触及2310阻力后回落,未能到达目标2340即反转。满足2.5/3项锚点破坏标准。同时盈利从+2.8%回撤至+0.66%(回撤76.4%),虽守住微利但趋势已变。及时平仓保护资本,避免微利转亏损。",
                "trade_score": 40,
                "confidence_score": 90,
                "key_support": 2250,
                "key_resistance": 2310
            }
        }
    }
]


# =====================================
# 持仓管理示例 (Position Management Examples)
# =====================================

POSITION_MANAGEMENT_EXAMPLES = [
    # 继续持有示例
    {
        "scenario": "锚点完好-继续持有",
        "context": """
【持仓】多头 | 入场42000 | 当前43500 | 盈亏+3.6% | MFE+4.2%
【市场】EMA多头排列保持,MACD金叉扩张150→180,ADX 28上升
""",
        "reasoning": "噪声检查通过→盈利保护:回撤14.3%未触发→止盈:3.6%未到5%→锚点:完好(0/3项破坏)→市场状态:趋势延续,ADX上升+MACD扩张→决策:signal_hold继续持有",
        "function": "signal_hold"
    },
    # 可以添加更多持仓管理示例...
]


# =====================================
# 示例使用说明
# =====================================

def get_entry_examples_for_prompt(max_examples: int = 2) -> str:
    """
    获取格式化的入场示例文本,用于插入提示词

    Args:
        max_examples: 最多返回几个示例(节省token)

    Returns:
        格式化的示例文本
    """
    examples_text = ["【参考案例 - 学习专业推理模式】", "以下是专业交易决策示例,展示正确的CoT推理链:", ""]

    for i, example in enumerate(ENTRY_EXAMPLES[:max_examples], 1):
        examples_text.extend([
            f"示例{i}: {example['scenario']}",
            example['market_context'],
            example['correct_reasoning'],
            f"函数调用: {example['function_call']['name']}",
            "---",
            ""
        ])

    return "\n".join(examples_text)


if __name__ == "__main__":
    # 测试示例输出
    print(get_entry_examples_for_prompt(max_examples=2))
    print(f"\n总共提供 {len(ENTRY_EXAMPLES)} 个入场示例")
